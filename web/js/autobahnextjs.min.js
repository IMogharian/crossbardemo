Ext.define("Ext.data.proxy.WampProxy",{extend:"Ext.data.proxy.Proxy",alias:"proxy.wamp",batchActions:!1,constructor:function(a){var b=this,a=a||{};b.addEvents("exception","oncreate","onupdate","ondestroy");b.superclass.constructor.apply(b,arguments);b.api=Ext.apply({},a.api||b.api);b.api.oncreate&&b.session.subscribe(b.api.oncreate,function(a,c){b.debug&&console.log("Ext.data.proxy.WampProxy.oncreate",c);b.fireEvent("oncreate",b,c)});b.api.onupdate&&b.session.subscribe(b.api.onupdate,function(a,c){b.debug&&
console.log("Ext.data.proxy.WampProxy.onupdate",c);b.fireEvent("onupdate",b,c)});b.api.ondestroy&&b.session.subscribe(b.api.ondestroy,function(a,c){b.debug&&console.log("Ext.data.proxy.WampProxy.ondestroy",c);b.fireEvent("ondestroy",b,c)})},create:function(a,b,e){var c=this;c.debug&&console.log("Ext.data.proxy.WampProxy.create",a);if(1<a.records.length)throw"WAMP proxy cannot process multiple CREATEs at once";var d=a.records[0];a.setStarted();this.session.call(this.api.create,d.data).then(function(f){d.phantom=
!1;d.setId(f.id);d.commit();a.setCompleted();a.setSuccessful();"function"===typeof b&&b.call(e||c,a)},function(d){c.debug&&console.log("WAMP RPC error",d);a.setException(d.desc);c.fireEvent("exception",c,d,a);"function"===typeof b&&b.call(e||c,a)})},update:function(a,b,e){var c=this;c.debug&&console.log("Ext.data.proxy.WampProxy.update",a);if(1<a.records.length)throw"WAMP proxy cannot process multiple UPDATEs at once";var d=a.records[0];a.setStarted();this.session.call(this.api.update,d.data).then(function(){d.commit();
a.setCompleted();a.setSuccessful();"function"===typeof b&&b.call(e||c,a)},function(d){c.debug&&console.log("WAMP RPC error",d);a.setException(d.desc);c.fireEvent("exception",c,d,a);"function"===typeof b&&b.call(e||c,a)})},destroy:function(a,b,e){var c=this;c.debug&&console.log("Ext.data.proxy.WampProxy.destroy",a);if(1<a.records.length)throw"WAMP proxy cannot process multiple DESTROYs at once";a.setStarted();this.session.call(this.api.destroy,a.records[0].getId()).then(function(){a.setCompleted();
a.setSuccessful();"function"===typeof b&&b.call(e||c,a)},function(d){c.debug&&console.log("WAMP RPC error",d);a.setException(d.desc);c.fireEvent("exception",c,d,a);"function"===typeof b&&b.call(e||c,a)})},read:function(a,b,e){var c=this,d;c.debug&&console.log("Ext.data.proxy.WampProxy.read",a);var f=Ext.applyIf(a.params||{},c.extraParams||{});void 0!==a.start&&(f.start=a.start);void 0!==a.limit&&(f.limit=a.limit);if(a.sorters&&0<a.sorters.length){f.sorters=[];for(d=0;d<a.sorters.length;++d)f.sorters.push({property:a.sorters[d].property,
direction:a.sorters[d].direction})}if(a.filters&&0<a.filters.length){f.filters=[];for(d=0;d<a.filters.length;++d)f.filters.push({property:a.filters[d].property,value:a.filters[d].value})}if(a.groupers&&0<a.groupers.length){f.groupers=[];for(d=0;d<a.groupers.length;++d)f.groupers.push({property:a.groupers[d].property,direction:a.groupers[d].direction||"ASC"})}this.session.call(this.api.read,f).then(function(d){var f=c.getReader();f.applyDefaults=true;a.resultSet=f.read(d);a.setCompleted();a.setSuccessful();
typeof b==="function"&&b.call(e||c,a)},function(d){a.setException(d.desc);c.fireEvent("exception",c,d,a);typeof b==="function"&&b.call(e||c,a)})}},function(){});
Ext.define("Ext.form.action.WampSubmit",{extend:"Ext.form.action.Submit",requires:["Ext.direct.Manager"],alternateClassName:"Ext.form.Action.WampSubmit",alias:"formaction.wampsubmit",type:"wampsubmit",doSubmit:function(){var a=this,b=a.getParams();a.api.debug&&console.log("Ext.form.action.WampSubmit.doSubmit",a.api,b);!a.api.session||!a.api.session._websocket_connected||!a.api.submit?(a.failureType=Ext.form.action.Action.CONNECT_FAILURE,a.form.afterAction(a,!1)):a.api.session.call(a.api.submit,b).then(function(b){a.api.debug&&
console.log("Form Submit Success",b);a.result=b;a.form.afterAction(a,!0)},function(b){a.api.debug&&console.log("Form Submit Error",b);a.failureType=Ext.form.action.Action.SERVER_INVALID;a.result=b;a.form.afterAction(a,!1)})}});
Ext.define("Ext.form.action.WampLoad",{extend:"Ext.form.action.Load",requires:["Ext.direct.Manager"],alternateClassName:"Ext.form.Action.WampLoad",alias:"formaction.wampload",type:"wampload",run:function(){var a=this,b=a.getParams();a.api.debug&&console.log("Ext.form.action.WampLoad.run",a.api,b);!a.api.session||!a.api.session._websocket_connected||!a.api.load?(a.failureType=Ext.form.action.Action.CONNECT_FAILURE,a.form.afterAction(a,!1)):a.api.session.call(a.api.load,b).then(function(b){a.api.debug&&
console.log("Form Load Success",b);a.form.clearInvalid();a.form.setValues(b);a.form.afterAction(a,!0)},function(b){a.api.debug&&console.log("Form Load Error",b);a.failureType=Ext.form.action.Action.LOAD_FAILURE;a.form.afterAction(a,!1)})}});
Ext.override(Ext.form.Basic,{submit:function(a){return this.api&&"wamp"===this.api.type?this.doAction("wampsubmit",a):this.doAction(this.standardSubmit?"standardsubmit":this.api?"directsubmit":"submit",a)},load:function(a){return this.api&&"wamp"===this.api.type?this.doAction("wampload",a):this.doAction(this.api?"directload":"load",a)},doAction:function(a,b){if(Ext.isString(a)){var e={form:this};this.api&&"wamp"===this.api.type&&(e.api=this.api);a=Ext.ClassManager.instantiateByAlias("formaction."+
a,Ext.apply({},b,e))}!1!==this.fireEvent("beforeaction",this,a)&&(this.beforeAction(a),a.run());return this}});
Ext.define("Ext.data.WampStore",{extend:"Ext.data.Store",autoSync:!1,constructor:function(){var a=this;Ext.data.WampStore.superclass.constructor.apply(a,arguments);a.model.proxy.on("oncreate",function(b,e){var c=a.getById(e[a.model.prototype.idProperty]);if(c){for(var d=a.model.prototype.fields.items,f=0;f<d.length;++f)void 0!==e[d[f].name]&&c.set(d[f].name,e[d[f].name]);c.dirty=!1}else c=[new a.model(e)],a.loadRecords(c,{addRecords:!0,start:0});a.sort()});a.model.proxy.on("onupdate",function(b,e){var c=
a.getById(e[a.model.prototype.idProperty]);if(c){for(var d=a.model.prototype.fields.items,f=0;f<d.length;++f)void 0!==e[d[f].name]&&c.set(d[f].name,e[d[f].name]);c.dirty=!1}});a.model.proxy.on("ondestroy",function(b,e){var c=a.getById(e[a.model.prototype.idProperty]);a.remove(c)})}});
Ext.define("Ext.data.WampTreeStore",{extend:"Ext.data.TreeStore",autoSync:!1,constructor:function(){var a=this;Ext.data.WampTreeStore.superclass.constructor.apply(a,arguments);a.model.proxy.on("oncreate",function(b,e){if(""===e[a.model.prototype.nodeParam])a.getRootNode().insertChild(0,e);else{var c=a.getRootNode().findChild(a.model.prototype.nodeParam,e[a.model.prototype.nodeParam]);c.isExpanded()?c.insertChild(0,e):c.expand()}a.sort([{property:"leaf",direction:"ASC"}])});a.model.proxy.on("onupdate",
function(b,e){a.getRootNode().findChild(a.model.prototype.idProperty,e[a.model.prototype.idProperty],!0).remove();""===e[a.model.prototype.nodeParam]?a.getRootNode().insertChild(0,e):a.getRootNode().findChild(a.model.prototype.nodeParam,e[a.model.prototype.nodeParam]).insertChild(0,e);a.sort([{property:"leaf",direction:"ASC"}])});a.model.proxy.on("ondestroy",function(b,e){a.getRootNode().findChild(a.model.prototype.idProperty,e[a.model.prototype.idProperty],!0).remove()})}});
